# Shared

## Classes

Uma classe é um modelo para criar objectos com atributos e comportamentos definidos.

- Embora Lua não suporte tipicamente programação orientada a objetos, é possível simulá-la com [metatables](https://www.lua.org/manual/5.4/manual.html#2.4).
- A nossa implementação de classes é vagamente baseada em [JavaScript](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes).

### Herança

As classes podem herdar atributos e comportamentos de outras classes, da mesma forma que as instâncias herdam da sua classe-mãe.

Ao especificar uma classe “super” numa declaração de classe, cria-se uma classe derivada ou “subclasse”. Esta subclasse herda tanto os campos como os métodos da sua classe-mãe. Esta herança estende-se a vários níveis de classes derivadas, permitindo que os atributos da classe sejam partilhados ao longo da hierarquia de classes.

### Encapsulamento

O encapsulamento é a prática de agrupar dados (atributos) e métodos (comportamentos) dentro de uma classe.

Esta prática ajuda a organizar as funcionalidades relacionadas e evita interferências externas no funcionamento interno da classe. Ao encapsular estes elementos, promovemos a modularidade, mantemos a integridade dos dados e controlamos a forma como os dados são acedidos e manipulados dentro de um programa.

## OxClass

OxClass é um modelo usado para todas as classes criadas com `lib.class`. Ele fornece alguns atributos básicos e comportamentos compartilhados por todas as classes.

### Atributos

- __name: `string`
  - Um campo protegido que representa o nome da classe.
- constructor?: `function`
  - Um método protegido utilizado para instanciar um novo objeto herdado de uma classe.
  - Called by `class:new(...)` if `class:constructor()` exists.
- private?: `table`
  - Um campo protegido que contém todos os dados privados de uma classe.
  - Os dados privados não podem ser acedidos fora dos métodos da classe, reforçando a segurança e a integridade dos dados.
- super?: `class`
  - Um método protegido que faz referência ao construtor de uma superclasse.
  - Deve ser chamado dentro de um construtor de classe ao instanciar uma classe.

## lib.class

Esta função permite-lhe definir uma nova classe, opcionalmente herdando de uma classe-mãe ou “super”.

```lua
local MyClass = lib.class(name, super)
```

### Parâmetros

- name: `string`
- super?: `table`
  - Define a nova classe como um subconjunto da superclasse.

### Returns
- `table`
  - A classe recém-criada.

### Exemplo

```lua
---@class Person : OxClass
---@field name string
local Person = lib.class('Person')

function Person:constructor(name)
    print('chamando o construtor Person para', name)
    self.name = name
end

-- Professor Class (extends Person)

---@class Professor : Person
---@field teaches string
local Professor = lib.class('Professor', Person)

function Professor:constructor(name, teaches)
    print('chamando o Professor construtor para', name)
    self:super(name)
    self.teaches = teaches
end

function Professor:introduceSelf()
    print(("O meu nome é %s, e serei o vosso professor de %s."):format(self.name, self.teaches))
end

function Professor:grade(paper)
    local grade = math.random(1, 4)
    print(grade)
end

CreateThread(function()
    local walter = Professor:new('Walter', 'Chemistry')

    walter:introduceSelf()
    walter:grade('o meu trabalho')
end)


-- Student Class (extends Person)

---@class Student : Person
---@field private private { year: number }
local Student = lib.class('Student', Person)

---@param name string
---@param year number
function Student:constructor(name, year)
    print('chamando o construtor do aluno para', name)
    self:super(name)
    self.private.year = year
end

function Student:introduceSelf()
    print(("Olá! Chamo-me %s e estou no ano %s."):format(self.name, self.private.year))
end

---@param year number
function Student:setYear(year)
    self.private.year = year
end

CreateThread(function()
    local jesse = Student:new('Jesse', 2)

    jesse:introduceSelf() -- Olá! Chamo-me Jesse e estou no 2º ano.
    jesse:setYear(3)
    jesse:introduceSelf() -- Olá! Chamo-me Jesse e estou no 3º ano.
    print(jesse.private.year) -- nil
    print(getmetatable(jesse.private)) -- private
    jesse.private.year = 4 -- error
end)
```